<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="keywords"
      content="bidding, fiverr, freelance marketplace, freelancers, freelancing, gigs, hiring, job board, job portal, job posting, jobs marketplace, peopleperhour, proposals, sell services, upwork"
    />
    <meta
      name="description"
      content="Freeio - Freelance Marketplace HTML Template"
    />
    <meta name="CreativeLayers" content="ATFN" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/ace-responsive-menu.css" />
    <link rel="stylesheet" href="css/menu.css" />
    <link rel="stylesheet" href="css/fontawesome.css" />
    <link rel="stylesheet" href="css/flaticon.css" />
    <link rel="stylesheet" href="css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="css/ud-custom-spacing.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="css/jquery-ui.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <title>Legalwize - Register</title>
    <link
      href="images/favicon.ico"
      sizes="128x128"
      rel="shortcut icon"
      type="image/x-icon"
    />
    <link href="images/favicon.ico" sizes="128x128" rel="shortcut icon" />
    <link
      href="images/apple-touch-icon-60x60.png"
      sizes="60x60"
      rel="apple-touch-icon"
    />
    <link
      href="images/apple-touch-icon-72x72.png"
      sizes="72x72"
      rel="apple-touch-icon"
    />
    <link
      href="images/apple-touch-icon-114x114.png"
      sizes="114x114"
      rel="apple-touch-icon"
    />
    <link
      href="images/apple-touch-icon-180x180.png"
      sizes="180x180"
      rel="apple-touch-icon"
    />
  </head>

  <body class="bgc-thm4">
    <div class="wrapper ovh">
      <div class="preloader"></div>

      <div id="header"></div>

      <div class="hiddenbar-body-ovelay"></div>

      <div class="body_content">
        <section class="our-register">
          <div class="container">
            <div class="row">
              <div class="col-lg-6 m-auto wow fadeInUp" data-wow-delay="300ms">
                <div class="main-title text-center">
                  <h2 class="title">Register</h2>
                  <p class="paragraph">
                    Give your visitor a smooth online experience with a solid UX
                    design
                  </p>
                </div>
              </div>
            </div>
            <div class="row wow fadeInRight" data-wow-delay="300ms">
              <div class="col-xl-6 mx-auto">
                <div
                  class="log-reg-form search-modal form-style1 bgc-white p50 p30-sm default-box-shadow1 bdrs12"
                >
                  <div class="mb30">
                    <h4>Let's create your account!</h4>
                    <p class="text mt20">
                      Already have an account?
                      <a href="login.html" class="text-thm">Log In!</a>
                    </p>
                  </div>
                  <div class="mb25">
                    <label class="form-label fw500 dark-color">Name</label>
                    <input
                      type="text"
                      id="displayName"
                      class="form-control"
                      placeholder="Full Name"
                    />
                  </div>
                  <div class="mb25">
                    <label class="form-label fw500 dark-color">Email</label>
                    <input
                      type="email"
                      id="email"
                      class="form-control"
                      placeholder="Email"
                    />
                  </div>
                  <div class="mb15">
                    <label class="form-label fw500 dark-color">Password</label>
                    <input
                      type="password"
                      id="password"
                      class="form-control"
                      placeholder="password"
                    />
                  </div>
                  <div class="d-grid mb20">
                    <button
                      id="registerBtn"
                      class="ud-btn btn-thm default-box-shadow2"
                      type="button"
                    >
                      Create Account <i class="fal fa-arrow-right-long"></i>
                    </button>
                  </div>
                  <div class="d-grid mb20">
                    <button
                      id="googleLoginBtn"
                      class="ud-btn btn-white default-box-shadow2"
                      type="button"
                    >
                      <img
                        src="https://img.icons8.com/color/16/000000/google-logo.png"
                      />
                      Continue with Google
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <footer id="footer"></footer>
        <a class="scrollToHome" href="#"><i class="fas fa-angle-up"></i></a>
      </div>
    </div>
    <script src="js/jquery-3.6.4.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-select.min.js"></script>
    <script src="js/jquery.mmenu.all.js"></script>
    <script src="js/ace-responsive-menu.js"></script>
    <script src="js/jquery-scrolltofixed-min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/component.js"></script>
    <script>
      function setComponents() {
        setFooter("footer");
        setHeader("header");
      }
      window.onload = setComponents;

      // Initialize mobile menu if present
      $(document).ready(function () {
        if ($("#menu").length) {
          $("#menu").mmenu();
        }
      });
    </script>

    <script type="module">
      // Firebase SDK Imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        updateProfile,
        onAuthStateChanged,
        GoogleAuthProvider,
        signInWithPopup,
        fetchSignInMethodsForEmail,
      } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyA0sJ4tCuSse4vDVN2g3NL-dPJJhs7iK4Y",
        authDomain: "legalwise-deeae.firebaseapp.com",
        projectId: "legalwise-deeae",
        storageBucket: "legalwise-deeae.appspot.com",
        messagingSenderId: "714896409549",
        appId: "1:714896409549:web:a33bef4794c2a14b3efa84",
        measurementId: "G-ZWDWL93QT4",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const provider = new GoogleAuthProvider();
      auth.languageCode = "en"; // Optional

      // ✅ Register Button Logic
      document
        .getElementById("registerBtn")
        .addEventListener("click", registerUser);

      async function registerUser() {
        const name = document.getElementById("displayName").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!name || !email || !password) {
          alert("Please fill in all fields.");
          return;
        }

        try {
          // ✅ Check if email already exists
          const methods = await fetchSignInMethodsForEmail(auth, email);
          if (methods.length > 0) {
            alert("❌ User already exists. Try logging in.");
            return;
          }

          // ✅ Create user
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;

          // ✅ Set Display Name
          await updateProfile(user, { displayName: name });

          // ✅ Save to Firestore
          await setDoc(doc(db, "users", user.uid), {
            uid: user.uid,
            name: name,
            email: email,
            createdAt: new Date().toISOString(),
          });

          alert("✅ Registration successful! Redirecting to login...");
          window.location.href = "login.html";
        } catch (error) {
          console.error(error);
          alert("❌ Registration failed: " + error.message);
        }
      }

      // ✅ Google Sign-In
      document
        .getElementById("googleLoginBtn")
        .addEventListener("click", async () => {
          try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;

            // ✅ Save user to Firestore if first login
            // Using merge: true ensures that if the user already exists, it only updates missing fields
            // and doesn't overwrite existing data (e.g., if you add more fields later)
            await setDoc(
              doc(db, "users", user.uid),
              {
                uid: user.uid,
                name: user.displayName || "", // Use displayName from Google profile
                email: user.email,
                createdAt: new Date().toISOString(), // Only set if not already present
              },
              { merge: true }
            );

            alert(
              `✅ Welcome, ${
                user.displayName || "User"
              }! Redirecting to dashboard...`
            );
            // Redirect to dashboard or home page after successful Google login
            window.location.href = "dashboard.html"; // <--- **THIS IS THE KEY CHANGE**
          } catch (error) {
            console.error(error);
            alert("❌ Google Sign-In Error: " + error.message);
          }
        });

      // ✅ Auto Redirect If Already Logged In (Optional - consider if you want this on a registration page)
      onAuthStateChanged(auth, (user) => {
        if (user) {
          console.log("Already logged in:", user.email);
          // Optional: Redirect to dashboard if they land on register page while logged in
          // window.location.href = "dashboard.html";
        }
      });
    </script>
  </body>
</html>